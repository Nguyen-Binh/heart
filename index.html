<!DOCTYPE html>
<html>
<head>
  <title>Love you "Doan Thu Thuy"</title>
  <meta charset="UTF-8">
  <style>
    html, body {
      overflow: hidden;
      padding: 0;
      margin: 0;
      background: #000;
    }

    #start-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      font-size: 34px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 10;
    }

    #start-button {
      margin-top: 20px;
      padding: 30px 50px;
      font-size: 34px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493;
    }

    canvas {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: block;
    }

    @keyframes pulse-glow {
      0% { text-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493; }
      50% { text-shadow: 0 0 20px #ff69b4, 0 0 40px #ff1493; }
      100% { text-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493; }
    }

    @keyframes loveZoom {
      0% {
        transform: translateX(-50%) scale(1);
        text-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493;
      }
      100% {
        transform: translateX(-50%) scale(1.8);
        text-shadow: 0 0 30px #ff69b4, 0 0 60px #ff1493, 0 0 90px #ff1493;
      }
    }

    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }

    .love-zoom-effect {
      animation: loveZoom 1.5s ease-out forwards;
    }

    #center-image {
      position: absolute;
      top: 48%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 280px;
      max-height: 280px;
      z-index: 2;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(255, 105, 180, 0.8), 0 0 50px rgba(255, 105, 180, 0.5);
      animation: pulse-glow 3s ease-in-out infinite, floatUpDown 6s ease-in-out infinite;
      display: none;
    }

    @keyframes floatUpDown {
      0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
      50% { transform: translate(-50%, -50%) translateY(-10px); }
    }

    #love-text {
      position: absolute;
      top: calc(50% + 85px);
      left: 50%;
      transform: translateX(-50%) scale(1);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      font-size: 30px;
      color: #ff69b4;
      z-index: 3;
      display: none;
    }

    #message-text1, #message-text2 {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      font-family: 'Segoe UI', sans-serif;
      font-size: 28px;
      color: #ffb6c1;
      text-align: center;
      line-height: 1.6;
      z-index: 3;
      white-space: pre-line;
      display: none;
    }

    #message-text1 {
      top: 15%;
    }

    #message-text2 {
      top: calc(50% + 350px);
    }
  </style>
</head>
<body>
  <audio id="bg-music" loop>
    <source src="https://nguyen-binh.github.io/heart/My_love.mp3" type="audio/mpeg">
  </audio>

  <div id="start-overlay">
    <div>Bạn Đoàn Thu Thủy đã sẵn sàng nhận món quà này chưa?</div>
    <button id="start-button">OK</button>
  </div>

  <img src="https://assets.onecompiler.app/43n2pjfqw/43n2q84vp/11.jpg" id="center-image">
  <div id="love-text">LOVE YOU</div>
  <div id="message-text1"></div>
  <div id="message-text2"></div>
  <canvas id="pinkboard"></canvas>
  <canvas id="spiral-canvas"></canvas>

  <script>
    function typeText(element, text, speed = 40) {
      return new Promise((resolve) => {
        element.innerHTML = '';
        let i = 0;
        function typing() {
          if (i < text.length) {
            if (text.substr(i, 4) === '<br>') {
              element.innerHTML += '<br>';
              i += 4;
            } else {
              element.innerHTML += text[i];
              i++;
            }
            setTimeout(typing, speed);
          } else {
            resolve();
          }
        }
        typing();
      });
    }

    document.getElementById('start-button').addEventListener('click', async function () {
      document.getElementById('bg-music').play();

      document.getElementById('start-overlay').style.display = 'none';
      document.getElementById('center-image').style.display = 'block';

      const loveText = document.getElementById('love-text');
      loveText.classList.add('pulse-glow');
      loveText.style.display = 'block';

      const messageText1 = document.getElementById('message-text1');
      const messageText2 = document.getElementById('message-text2');

      const content1 = `Gặp em là một điều thật tuyệt vời. Có lẽ anh đã giành hết may mắn vào điều đó.<br>
Bởi vì anh đã từng một mình rất lâu trước đó, nên sự xuất hiện của em như thể là một điều dịu dàng nhất trên hành trình của anh.`;

      const content2 = `Nếu có thể, anh muốn hạnh phúc của anh...<br>
CÓ EM, LUÔN CÓ EM TRONG ĐÓ.<br>
Vậy nhé !!!!!`;

      messageText1.style.display = 'block';
      await typeText(messageText1, content1);

      messageText2.style.display = 'block';
      await typeText(messageText2, content2);

      loveText.classList.remove('pulse-glow');
      loveText.classList.add('love-zoom-effect');
    });
  </script>
<script>
  const pinkCanvas = document.getElementById('pinkboard');
  const ctx = pinkCanvas.getContext('2d');
  pinkCanvas.width = window.innerWidth;
  pinkCanvas.height = window.innerHeight;

  const settings = {
    particles: {
      length: 1200,
      duration: 2,
      velocity: 135,
      effect: -0.35,
      size: 14,
    }
  };

  const Point = function (x, y) {
    this.x = x || 0;
    this.y = y || 0;
  };
  Point.prototype.clone = function () { return new Point(this.x, this.y); };
  Point.prototype.length = function (length) {
    if (length === undefined)
      return Math.sqrt(this.x * this.x + this.y * this.y);
    this.normalize();
    this.x *= length;
    this.y *= length;
    return this;
  };
  Point.prototype.normalize = function () {
    const length = this.length();
    this.x /= length;
    this.y /= length;
    return this;
  };

  const Particle = function () {
    this.position = new Point();
    this.velocity = new Point();
    this.acceleration = new Point();
    this.age = 0;
  };
  Particle.prototype.initialize = function (x, y, dx, dy) {
    this.position.x = x;
    this.position.y = y;
    this.velocity.x = dx;
    this.velocity.y = dy;
    this.acceleration.x = dx * settings.particles.effect;
    this.acceleration.y = dy * settings.particles.effect;
    this.age = 0;
  };
  Particle.prototype.update = function (deltaTime) {
    this.position.x += this.velocity.x * deltaTime;
    this.position.y += this.velocity.y * deltaTime;
    this.velocity.x += this.acceleration.x * deltaTime;
    this.velocity.y += this.acceleration.y * deltaTime;
    this.age += deltaTime;
  };
  Particle.prototype.draw = function (context, image) {
    const ease = (t) => (--t) * t * t + 1;
    const size = image.width * ease(this.age / settings.particles.duration);
    context.globalAlpha = 1 - this.age / settings.particles.duration;
    context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
  };

  const ParticlePool = function (length) {
    this.particles = new Array(length);
    for (let i = 0; i < this.particles.length; i++) {
      this.particles[i] = new Particle();
    }
    this.firstActive = 0;
    this.firstFree = 0;
    this.duration = settings.particles.duration;
  };
  ParticlePool.prototype.add = function (x, y, dx, dy) {
    this.particles[this.firstFree].initialize(x, y, dx, dy);
    this.firstFree = (this.firstFree + 1) % this.particles.length;
    if (this.firstActive === this.firstFree) {
      this.firstActive = (this.firstActive + 1) % this.particles.length;
    }
  };
  ParticlePool.prototype.update = function (deltaTime) {
    let i;
    if (this.firstActive < this.firstFree) {
      for (i = this.firstActive; i < this.firstFree; i++) {
        this.particles[i].update(deltaTime);
      }
    } else {
      for (i = this.firstActive; i < this.particles.length; i++) {
        this.particles[i].update(deltaTime);
      }
      for (i = 0; i < this.firstFree; i++) {
        this.particles[i].update(deltaTime);
      }
    }
    while (this.particles[this.firstActive].age >= this.duration && this.firstActive !== this.firstFree) {
      this.firstActive = (this.firstActive + 1) % this.particles.length;
    }
  };
  ParticlePool.prototype.draw = function (context, image) {
    let i;
    if (this.firstActive < this.firstFree) {
      for (i = this.firstActive; i < this.firstFree; i++) {
        this.particles[i].draw(context, image);
      }
    } else {
      for (i = this.firstActive; i < this.particles.length; i++) {
        this.particles[i].draw(context, image);
      }
      for (i = 0; i < this.firstFree; i++) {
        this.particles[i].draw(context, image);
      }
    }
  };

  function pointOnHeart(t) {
    return new Point(
      160 * Math.pow(Math.sin(t), 3),
      130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
    );
  }

  const createHeartImage = () => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = settings.particles.size;
    canvas.height = settings.particles.size;

    ctx.beginPath();
    let t = -Math.PI;
    const to = (t) => {
      const point = pointOnHeart(t);
      point.x = settings.particles.size / 3 + point.x * settings.particles.size / 300;
      point.y = settings.particles.size / 3 - point.y * settings.particles.size / 300;
      return point;
    };
    let point = to(t);
    ctx.moveTo(point.x, point.y);
    while (t < Math.PI) {
      t += 0.01;
      point = to(t);
      ctx.lineTo(point.x, point.y);
    }
    ctx.closePath();
    ctx.fillStyle = '#ea80b0';
    ctx.fill();

    const img = new Image();
    img.src = canvas.toDataURL();
    return img;
  };

  const heartImage = createHeartImage();
  const particles = new ParticlePool(settings.particles.length);
  const particleRate = settings.particles.length / settings.particles.duration;
  let time;

  function render() {
    requestAnimationFrame(render);
    const newTime = Date.now() / 1000;
    const deltaTime = newTime - (time || newTime);
    time = newTime;

    ctx.clearRect(0, 0, pinkCanvas.width, pinkCanvas.height);

    const amount = Math.round(particleRate * deltaTime);
    for (let i = 0; i < amount; i++) {
      const pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
      const dir = pos.clone().length(settings.particles.velocity);
      particles.add(
        pinkCanvas.width / 2 + pos.x,
        pinkCanvas.height / 2 - pos.y,
        dir.x,
        -dir.y
      );
    }

    particles.update(deltaTime);
    particles.draw(ctx, heartImage);
  }

  render();
</script>

</body>
</html>
