<!DOCTYPE html>
<html>
<head>
  <title>Love you "Doan Thu Thuy"</title>
  <meta charset="UTF-8">
  <style>
    html, body {
      overflow: hidden;
      padding: 0;
      margin: 0;
      background: #000;
    }

    #start-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      font-size: 34px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 10;
    }

    #start-button {
      margin-top: 20px;
      padding: 30px 50px;
      font-size: 34px;
      background-color: #ff69b4;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493;
    }

    canvas {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      display: block;
    }

    @keyframes heart {
      0% { transform: scale(1); }
      30% { transform: scale(.8); }
      100% { transform: scale(1); }
    }

    #center-image {
      position: absolute;
      top: 48%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 280px;
      max-height: 280px;
      z-index: 2;
      border-radius: 12px;
      box-shadow: 0 0 25px rgba(255, 105, 180, 0.8), 0 0 50px rgba(255, 105, 180, 0.5);
      animation: pulse-glow 3s ease-in-out infinite, floatUpDown 6s ease-in-out infinite;
      display: none;
    }

    @keyframes pulse-glow {
      0% { box-shadow: 0 0 10px rgba(255, 105, 180, 0.3), 0 0 20px rgba(255, 105, 180, 0.2); }
      50% { box-shadow: 0 0 30px rgba(255, 105, 180, 0.9), 0 0 60px rgba(255, 105, 180, 0.6); }
      100% { box-shadow: 0 0 10px rgba(255, 105, 180, 0.3), 0 0 20px rgba(255, 105, 180, 0.2); }
    }

    @keyframes floatUpDown {
      0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
      50% { transform: translate(-50%, -50%) translateY(-10px); }
    }

    #love-text {
      position: absolute;
      top: calc(50% + 85px);
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      font-size: 30px;
      color: #ff69b4;
      text-shadow: 0 0 10px #ff69b4, 0 0 20px #ff1493;
      z-index: 3;
      animation: pulse-glow 2s ease-in-out infinite;
      display: none;
    }

    #message-text1 {
      position: absolute;
      top: calc(15%);
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      font-family: 'Segoe UI', sans-serif;
      font-size: 28px;
      color: #ffb6c1;
      text-align: center;
      line-height: 1.6;
      z-index: 3;
      animation: fadein 3s ease-in-out;
      white-space: pre-line;
      display: none;
    }
    #message-text2 {
      position: absolute;
      top: calc(50% + 350px);
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      font-family: 'Segoe UI', sans-serif;
      font-size: 30px;
      color: #ffb6c1;
      text-align: center;
      line-height: 1.6;
      z-index: 3;
      animation: fadein 3s ease-in-out;
      white-space: pre-line;
      display: none;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
  </style>
</head>

<audio id="bg-music" loop>
  <source src="https://nguyen-binh.github.io/heart/My_love.mp3" type="audio/mpeg">
</audio>

<body>
  <div id="start-overlay">
    <div>Bạn Đoàn Thu Thủy đã sẵn sàng nhận món quà này chưa?</div>
    <button id="start-button">OK</button>
  </div>

  <img src="https://assets.onecompiler.app/43n2pjfqw/43n2q84vp/11.jpg" id="center-image">
  <div id="love-text">LOVE YOU</div>
  <canvas id="pinkboard"></canvas>
  <canvas id="spiral-canvas"></canvas>

  <script>
function typeText(element, text, speed = 40) {
  return new Promise((resolve) => {
    element.innerHTML = '';
    let i = 0;
    function typing() {
      if (i < text.length) {
        if (text.substr(i, 4) === '<br>') {
          element.innerHTML += '<br>';
          i += 4;
        } else {
          element.innerHTML += text[i];
          i++;
        }
        setTimeout(typing, speed);
      } else {
        resolve(); // báo hiệu hoàn thành
      }
    }
    typing();
  });
}
  document.getElementById('start-button').addEventListener('click', async function () {
  document.getElementById('start-overlay').style.display = 'none';
  document.getElementById('center-image').style.display = 'block';
  document.getElementById('love-text').style.display = 'block';

  const messageText1 = document.getElementById('message-text1');
  const messageText2 = document.getElementById('message-text2');

  const content1 = `Gặp em là một điều thật tuyệt vời. Có lẽ anh đã giành hết may mắn vào điều đó.<br>
Bởi vì anh đã từng một mình rất lâu trước đó, nên sự xuất hiện của em như thể là một điều dịu dàng nhất trong cuộc sống bộn bề này.`;

  const content2 = `Nếu có thể, anh muốn hạnh phúc của anh...<br>
Có em, luôn có em trong đó.`;

  messageText1.style.display = 'block';
  await typeText(messageText1, content1);   // Chờ messageText1 xong

  messageText2.style.display = 'block';
  await typeText(messageText2, content2);   // Rồi mới hiện messageText2

  document.getElementById('bg-music').play();
});

  </script>

  <!-- Spiral only (no flying heart) -->
  <script>
    const spiralCanvas = document.getElementById('spiral-canvas');
    const ctxSpiral = spiralCanvas.getContext('2d');

    function resizeSpiralCanvas() {
      spiralCanvas.width = window.innerWidth;
      spiralCanvas.height = window.innerHeight;
    }
    resizeSpiralCanvas();
    window.addEventListener('resize', resizeSpiralCanvas);

    function animateSpiral() {
      requestAnimationFrame(animateSpiral);
      ctxSpiral.clearRect(0, 0, spiralCanvas.width, spiralCanvas.height);

      const centerX = spiralCanvas.width / 2;
      const centerY = spiralCanvas.height / 2 + 100;

      for (let i = 0; i < 100; i++) {
        const angle = (Date.now() * 0.001 + i * 0.3) % (2 * Math.PI);
        const radius = 30 + i * 0.6;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        ctxSpiral.fillStyle = `rgba(255, 255, 255, ${0.02 + 0.01 * i})`;
        ctxSpiral.beginPath();
        ctxSpiral.arc(x, y, 1.5, 0, Math.PI * 2);
        ctxSpiral.fill();
      }
    }

    animateSpiral();
  </script>

  <!-- Heart particle system (original) -->
  <script>
    var settings = {
      particles: {
        length: 1500,
        duration: 2,
        velocity: 135,
        effect: -0.35,
        size: 14,
      },
    };

    (function () {
      var b = 0;
      var c = ["ms", "moz", "webkit", "o"];
      for (var a = 0; a < c.length && !window.requestAnimationFrame; ++a) {
        window.requestAnimationFrame = window[c[a] + "RequestAnimationFrame"];
        window.cancelAnimationFrame = window[c[a] + "CancelAnimationFrame"]
          || window[c[a] + "CancelRequestAnimationFrame"];
      }
      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function (h, e) {
          var d = new Date().getTime();
          var f = Math.max(0, 16 - (d - b));
          var g = window.setTimeout(function () { h(d + f) }, f);
          b = d + f;
          return g;
        }
      }
      if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function (d) { clearTimeout(d) }
      }
    }());

    var Point = function (x, y) {
      this.x = x || 0;
      this.y = y || 0;
    };
    Point.prototype.clone = function () { return new Point(this.x, this.y); };
    Point.prototype.length = function (length) {
      if (length === undefined) return Math.sqrt(this.x * this.x + this.y * this.y);
      this.normalize();
      this.x *= length;
      this.y *= length;
      return this;
    };
    Point.prototype.normalize = function () {
      var length = this.length();
      this.x /= length;
      this.y /= length;
      return this;
    };

    var Particle = function () {
      this.position = new Point();
      this.velocity = new Point();
      this.acceleration = new Point();
      this.age = 0;
    };
    Particle.prototype.initialize = function (x, y, dx, dy) {
      this.position.x = x;
      this.position.y = y;
      this.velocity.x = dx;
      this.velocity.y = dy;
      this.acceleration.x = dx * settings.particles.effect;
      this.acceleration.y = dy * settings.particles.effect;
      this.age = 0;
    };
    Particle.prototype.update = function (deltaTime) {
      this.position.x += this.velocity.x * deltaTime;
      this.position.y += this.velocity.y * deltaTime;
      this.velocity.x += this.acceleration.x * deltaTime;
      this.velocity.y += this.acceleration.y * deltaTime;
      this.age += deltaTime;
    };
    Particle.prototype.draw = function (context, image) {
      function ease(t) { return (--t) * t * t + 1; }
      var size = image.width * ease(this.age / settings.particles.duration);
      context.globalAlpha = 1 - this.age / settings.particles.duration;
      context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
    };

    var ParticlePool = function (length) {
      this.particles = new Array(length);
      for (var i = 0; i < this.particles.length; i++) {
        this.particles[i] = new Particle();
      }
      this.firstActive = 0;
      this.firstFree = 0;
      this.duration = settings.particles.duration;
    };
    ParticlePool.prototype.add = function (x, y, dx, dy) {
      this.particles[this.firstFree].initialize(x, y, dx, dy);
      this.firstFree = (this.firstFree + 1) % this.particles.length;
      if (this.firstActive === this.firstFree) {
        this.firstActive = (this.firstActive + 1) % this.particles.length;
      }
    };
    ParticlePool.prototype.update = function (deltaTime) {
      var i;
      if (this.firstActive < this.firstFree) {
        for (i = this.firstActive; i < this.firstFree; i++) this.particles[i].update(deltaTime);
      } else {
        for (i = this.firstActive; i < this.particles.length; i++) this.particles[i].update(deltaTime);
        for (i = 0; i < this.firstFree; i++) this.particles[i].update(deltaTime);
      }
      while (this.particles[this.firstActive].age >= this.duration && this.firstActive !== this.firstFree) {
        this.firstActive = (this.firstActive + 1) % this.particles.length;
      }
    };
    ParticlePool.prototype.draw = function (context, image) {
      var i;
      if (this.firstActive < this.firstFree) {
        for (i = this.firstActive; i < this.firstFree; i++) this.particles[i].draw(context, image);
      } else {
        for (i = this.firstActive; i < this.particles.length; i++) this.particles[i].draw(context, image);
        for (i = 0; i < this.firstFree; i++) this.particles[i].draw(context, image);
      }
    };

    (function (canvas) {
      var context = canvas.getContext('2d'),
        particles = new ParticlePool(settings.particles.length),
        particleRate = settings.particles.length / settings.particles.duration,
        time;

      function pointOnHeart(t) {
        return new Point(
          160 * Math.pow(Math.sin(t), 3),
          130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
        );
      }

      var image = (function () {
        var canvas = document.createElement('canvas'),
          context = canvas.getContext('2d');
        canvas.width = settings.particles.size;
        canvas.height = settings.particles.size;

        function to(t) {
          var point = pointOnHeart(t);
          point.x = settings.particles.size / 3 + point.x * settings.particles.size / 300;
          point.y = settings.particles.size / 3 - point.y * settings.particles.size / 300;
          return point;
        }

        context.beginPath();
        var t = -Math.PI;
        var point = to(t);
        context.moveTo(point.x, point.y);
        while (t < Math.PI) {
          t += 0.01;
          point = to(t);
          context.lineTo(point.x, point.y);
        }
        context.closePath();
        context.fillStyle = '#ea80b0'; // Màu hồng gốc
        context.fill();

        var img = new Image();
        img.src = canvas.toDataURL();
        return img;
      })();

      function render() {
        requestAnimationFrame(render);
        var newTime = new Date().getTime() / 1000,
          deltaTime = newTime - (time || newTime);
        time = newTime;
        context.clearRect(0, 0, canvas.width, canvas.height);
        var amount = Math.round(particleRate * deltaTime);
        for (var i = 0; i < amount; i++) {
          var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
          var dir = pos.clone().length(settings.particles.velocity);
          particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
        }
        particles.update(deltaTime);
        particles.draw(context, image);
      }

      function onResize() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
      }

      window.addEventListener('resize', onResize);
      window.addEventListener('load', function () {
        onResize();
        render();
      });
    })(document.getElementById('pinkboard'));
  </script>
</body>
</html>
